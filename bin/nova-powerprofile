#!/bin/bash
# Select and set power profile (matches omarchy approach)

current=$(powerprofilesctl get 2>/dev/null)
if [[ -z "$current" ]]; then
    notify-send "Power Profile" "powerprofilesctl not available"
    exit 1
fi

# Get available profiles using omarchy's parsing method
profiles=$(powerprofilesctl list 2>/dev/null | \
    awk '/^\s*[* ]\s*[a-zA-Z0-9\-]+:$/ { gsub(/^[*[:space:]]+|:$/,""); print }' | \
    tac)

if [[ -z "$profiles" ]]; then
    notify-send "Power Profile" "No profiles available"
    exit 1
fi

# Show menu (current profile will be at top due to tac reversal)
selected=$(printf '%s\n' $profiles | fuzzel --dmenu -p "Power Profile: " -w 30 -l 5)
[[ -z "$selected" ]] && exit 0

# Set profile if different
if [[ "$selected" != "$current" ]]; then
    powerprofilesctl set "$selected"
    notify-send "Power Profile" "Set to $selected"
fi

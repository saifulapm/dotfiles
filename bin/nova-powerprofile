#!/bin/bash
# Select and set power profile

current=$(powerprofilesctl get 2>/dev/null)
if [[ -z "$current" ]]; then
    notify-send "Power Profile" "powerprofilesctl not available"
    exit 1
fi

# Get available profiles
profiles=$(powerprofilesctl list 2>/dev/null | grep -oP '^\s*\K\w+(?=:)')

# Mark current profile
menu_items=""
while IFS= read -r profile; do
    if [[ "$profile" == "$current" ]]; then
        menu_items+="$profile (current)\n"
    else
        menu_items+="$profile\n"
    fi
done <<< "$profiles"

# Show menu
selected=$(echo -e "$menu_items" | grep -v '^$' | fuzzel --dmenu -p "Power Profile" -w 30 -l 5)
[[ -z "$selected" ]] && exit 0

# Remove (current) suffix if present
selected=$(echo "$selected" | sed 's/ (current)//')

# Set profile if different
if [[ "$selected" != "$current" ]]; then
    powerprofilesctl set "$selected"
    notify-send "Power Profile" "Set to $selected"
fi

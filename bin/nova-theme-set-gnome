#!/bin/bash

# Nova GNOME Theme Setter
# Syncs theme settings to GNOME/GTK for file manager theming

DOTFILES="${DOTFILES:-$HOME/.dotfiles}"
THEME_NAME="$1"

# If no theme name provided, try to get current theme
if [[ -z "$THEME_NAME" ]]; then
    THEME_FILE="$HOME/.config/nova/current/theme.name"
    if [[ -f "$THEME_FILE" ]]; then
        THEME_NAME="$(<$THEME_FILE)"
    fi
fi

# Exit if still no theme
if [[ -z "$THEME_NAME" ]]; then
    echo "Usage: nova-theme-set-gnome <theme-name>"
    exit 1
fi

THEME_PATH="$DOTFILES/themes/$THEME_NAME"

# Check if theme exists
if [[ ! -d "$THEME_PATH" ]]; then
    echo "Theme not found: $THEME_NAME"
    exit 1
fi

# Set color scheme based on light/dark mode
if [[ -f "$THEME_PATH/light.mode" ]]; then
    gsettings set org.gnome.desktop.interface color-scheme "prefer-light" 2>/dev/null || true
    gsettings set org.gnome.desktop.interface gtk-theme "Adwaita" 2>/dev/null || true
else
    gsettings set org.gnome.desktop.interface color-scheme "prefer-dark" 2>/dev/null || true
    gsettings set org.gnome.desktop.interface gtk-theme "Adwaita-dark" 2>/dev/null || true
fi

# Set icon theme if specified
ICONS_FILE="$THEME_PATH/icons.theme"
if [[ -f "$ICONS_FILE" ]]; then
    ICON_THEME="$(<$ICONS_FILE)"
    # Trim whitespace
    ICON_THEME="${ICON_THEME// /}"
    gsettings set org.gnome.desktop.interface icon-theme "$ICON_THEME" 2>/dev/null || true
else
    # Default icon theme
    gsettings set org.gnome.desktop.interface icon-theme "breeze" 2>/dev/null || true
fi

# Set fonts
gsettings set org.gnome.desktop.interface font-name "Maple Mono NF 11" 2>/dev/null || true
gsettings set org.gnome.desktop.interface document-font-name "Maple Mono NF 11" 2>/dev/null || true
gsettings set org.gnome.desktop.interface monospace-font-name "Maple Mono NF 11" 2>/dev/null || true

# Set font rendering
gsettings set org.gnome.desktop.interface font-antialiasing "rgba" 2>/dev/null || true
gsettings set org.gnome.desktop.interface font-hinting "full" 2>/dev/null || true

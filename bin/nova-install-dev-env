#!/bin/bash
# Install development environments using mise

ENV="$1"

if [[ -z "$ENV" ]]; then
    echo "Usage: nova-install-dev-env <environment>"
    echo "Available: ruby, node, bun, deno, go, python, rust, java, dotnet"
    exit 1
fi

# Ensure mise is available
if ! command -v mise &>/dev/null; then
    echo "Error: mise is not installed. Run setup.sh first."
    exit 1
fi

case "$ENV" in
    ruby)
        echo -e "Installing Ruby on Rails...\n"
        # Install libyaml dependency
        sudo dnf install -y libyaml-devel
        mise use --global ruby@latest
        mise settings add idiomatic_version_file_enable_tools ruby
        echo "gem: --no-document" > ~/.gemrc
        mise x ruby -- gem install rails bundler --no-document
        echo -e "\nRuby installed! You can now run: rails new myproject"
        ;;
    node)
        echo -e "Installing Node.js...\n"
        mise use --global node@lts
        npm install -g yarn pnpm
        echo -e "\nNode.js installed with yarn and pnpm"
        ;;
    bun)
        echo -e "Installing Bun...\n"
        mise use --global bun@latest
        echo "Bun installed"
        ;;
    deno)
        echo -e "Installing Deno...\n"
        mise use --global deno@latest
        echo "Deno installed"
        ;;
    go)
        echo -e "Installing Go...\n"
        mise use --global go@latest
        echo "Go installed"
        ;;
    python)
        echo -e "Installing Python...\n"
        mise use --global python@latest
        echo -e "\nInstalling uv (fast Python package manager)...\n"
        curl -LsSf https://astral.sh/uv/install.sh | sh
        echo -e "\nPython installed with uv"
        ;;
    rust)
        echo -e "Installing Rust...\n"
        if command -v rustup &>/dev/null; then
            echo "Rust already installed, updating..."
            rustup update
        else
            curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
            source "$HOME/.cargo/env"
        fi
        rustup default stable
        echo "Rust installed"
        ;;
    java)
        echo -e "Installing Java...\n"
        mise use --global java@latest
        echo "Java installed"
        ;;
    dotnet)
        echo -e "Installing .NET SDK...\n"
        # Fedora has dotnet in repos
        sudo dnf install -y dotnet-sdk-8.0
        echo ".NET SDK 8.0 installed"
        ;;
    *)
        echo "Unknown environment: $ENV"
        echo "Available: ruby, node, bun, deno, go, python, rust, java, dotnet"
        exit 1
        ;;
esac

echo -e "\nDone! You may need to restart your shell or run: source ~/.bashrc"

#!/bin/bash

# Set browser theme color for Chromium (omarchy-chromium fork)
# Uses CLI flags for live theme changes

DOTFILES="${DOTFILES:-$HOME/.dotfiles}"
THEME_DIR="$DOTFILES/themes"
THEME_FILE="$HOME/.config/nova/current/theme.name"

# Only works with omarchy-chromium
if ! command -v chromium &>/dev/null; then
    exit 0
fi

CURRENT_THEME=$(cat "$THEME_FILE" 2>/dev/null || echo "")

if [[ -z "$CURRENT_THEME" ]]; then
    exit 0
fi

CHROMIUM_THEME="$THEME_DIR/$CURRENT_THEME/chromium.theme"

if [[ -f "$CHROMIUM_THEME" ]]; then
    THEME_RGB=$(<"$CHROMIUM_THEME")
else
    # Default neutral grey if theme doesn't have a color
    THEME_RGB="28,32,39"
fi

# Set theme color
chromium --no-startup-window --set-theme-color="$THEME_RGB" >/dev/null 2>&1

# Set color scheme (light/dark)
if [[ -f "$THEME_DIR/$CURRENT_THEME/light.mode" ]]; then
    chromium --no-startup-window --set-color-scheme="light" >/dev/null 2>&1
else
    chromium --no-startup-window --set-color-scheme="dark" >/dev/null 2>&1
fi

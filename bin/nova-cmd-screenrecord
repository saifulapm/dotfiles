#!/bin/bash
# Toggle screen recording with wf-recorder

PID=$(pgrep -x wf-recorder)

if [ -n "$PID" ]; then
    # Stop recording
    kill -SIGINT "$PID"
    sleep 0.3  # Wait for process to exit before refreshing indicator
else
    # Start recording
    mkdir -p "$HOME/Videos/Recordings"
    # Get the first available output from niri
    OUTPUT=$(niri msg outputs 2>/dev/null | grep -oP '(?<=\()\w+-\d+(?=\))' | head -1)
    OUTPUT=${OUTPUT:-eDP-1}  # Fallback to eDP-1
    wf-recorder -o "$OUTPUT" -f "$HOME/Videos/Recordings/$(date +%Y%m%d_%H%M%S).mp4" >/dev/null 2>&1 &
fi

# Refresh waybar indicator
pkill -RTMIN+8 waybar

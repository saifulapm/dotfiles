#!/bin/bash
# Create or edit Nova hooks

HOOKS_DIR="$HOME/.config/nova/hooks"
DOTFILES="${DOTFILES:-$HOME/.dotfiles}"
EXAMPLES_DIR="$DOTFILES/default/hooks"

show_help() {
    cat << 'EOF'
Usage: nova-hook-edit <hook-name>

Creates a new hook from template or opens existing hook in editor.

Available hook templates:
    theme-set      After theme changes
    font-set       After font changes
    screenshot     After screenshot taken
    pkg-install    After package installed

Examples:
    nova-hook-edit theme-set
    nova-hook-edit my-custom-hook
EOF

    echo ""
    echo "Existing hooks in $HOOKS_DIR:"
    ls -1 "$HOOKS_DIR" 2>/dev/null || echo "  (none)"
}

create_hook() {
    local hook_name="$1"
    local hook_path="$HOOKS_DIR/$hook_name"

    mkdir -p "$HOOKS_DIR"

    # If hook doesn't exist, create from template or default
    if [[ ! -f "$hook_path" ]]; then
        if [[ -f "$EXAMPLES_DIR/${hook_name}.example" ]]; then
            cp "$EXAMPLES_DIR/${hook_name}.example" "$hook_path"
            echo "Created from template: $hook_path"
        else
            cat > "$hook_path" << EOF
#!/bin/bash
# Hook: $hook_name
# Arguments: \$@

# Your code here
echo "Hook '$hook_name' executed with args: \$@"
EOF
            echo "Created new hook: $hook_path"
        fi
        chmod +x "$hook_path"
    fi

    # Open in editor
    "${EDITOR:-${VISUAL:-nano}}" "$hook_path"
}

case "${1:-}" in
    -h|--help|"") show_help ;;
    *) create_hook "$1" ;;
esac

#!/bin/bash
# Share clipboard, file, or folder using LocalSend

MODE="${1:-clipboard}"

if [[ "$MODE" == "clipboard" ]]; then
    TEMP_FILE=$(mktemp --suffix=.txt)
    wl-paste > "$TEMP_FILE"
    if [[ ! -s "$TEMP_FILE" ]]; then
        notify-send "Share" "Clipboard is empty"
        rm -f "$TEMP_FILE"
        exit 1
    fi
    FILES="$TEMP_FILE"
else
    if [[ "$MODE" == "folder" ]]; then
        FILES=$(find "$HOME" -maxdepth 3 -type d 2>/dev/null | fzf --prompt="Select folder: ")
    else
        FILES=$(find "$HOME" -maxdepth 4 -type f 2>/dev/null | fzf --multi --prompt="Select file(s): ")
    fi
    [[ -z "$FILES" ]] && exit 0
fi

# Run LocalSend detached (flatpak version)
if echo "$FILES" | grep -q $'\n'; then
    # Multiple files
    readarray -t FILE_ARRAY <<< "$FILES"
    flatpak run org.localsend.localsend_app "${FILE_ARRAY[@]}" &
else
    flatpak run org.localsend.localsend_app "$FILES" &
fi

notify-send "Share" "Opening LocalSend..."
